<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>LifePath AI ‚Äì Career & Growth Guide</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet" />
  <style>
    /* CSS REMAINS EXACTLY THE SAME */
    :root {
      --primary-color: #6366f1; --secondary-color: #8b5cf6; --accent-color: #10b981;
      --text-dark: #1f2937; --text-light: #6b7280;
      --bg-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      --glass-bg: rgba(255, 255, 255, 0.95); --glass-border: rgba(255, 255, 255, 0.5);
    }
    * { box-sizing: border-box; }
    body { font-family: 'Poppins', sans-serif; background: var(--bg-gradient); min-height: 100vh; margin: 0; padding: 40px 20px; color: var(--text-dark); line-height: 1.6; }
    .container { max-width: 800px; margin: auto; }
    h1 { text-align: center; font-size: 42px; font-weight: 700; color: #ffffff; margin-bottom: 10px; text-shadow: 0 4px 6px rgba(0,0,0,0.1); letter-spacing: -1px; }
    .subtitle { text-align: center; color: rgba(255, 255, 255, 0.9); margin-bottom: 50px; font-size: 18px; font-weight: 300; }
    .box { background: var(--glass-bg); backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px); border: 1px solid var(--glass-border); border-radius: 24px; padding: 32px; box-shadow: 0 10px 40px -10px rgba(0, 0, 0, 0.2); margin-bottom: 30px; transition: transform 0.3s ease, box-shadow 0.3s ease; position: relative; overflow: hidden; }
    .box:hover { transform: translateY(-5px); box-shadow: 0 20px 50px -10px rgba(0, 0, 0, 0.3); }
    .box::before { content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 6px; background: linear-gradient(to right, var(--primary-color), var(--secondary-color)); }
    h2 { font-size: 24px; color: var(--text-dark); margin-top: 0; margin-bottom: 20px; display: flex; align-items: center; gap: 10px; }
    input, select, textarea { width: 100%; padding: 16px; margin-top: 8px; margin-bottom: 20px; border: 2px solid #e5e7eb; border-radius: 12px; font-family: 'Poppins', sans-serif; font-size: 15px; background: #f9fafb; transition: all 0.3s ease; }
    input:focus, select:focus, textarea:focus { outline: none; border-color: var(--primary-color); background: #ffffff; box-shadow: 0 0 0 4px rgba(99, 102, 241, 0.1); }
    button { width: 100%; padding: 16px; background: linear-gradient(to right, var(--primary-color), var(--secondary-color)); color: white; border: none; border-radius: 12px; cursor: pointer; font-weight: 600; font-size: 16px; letter-spacing: 0.5px; transition: all 0.3s ease; box-shadow: 0 4px 15px rgba(99, 102, 241, 0.3); }
    button:hover { transform: translateY(-2px); box-shadow: 0 8px 25px rgba(99, 102, 241, 0.4); filter: brightness(1.1); }
    button:disabled { background: #ccc; cursor: not-allowed; transform: none; box-shadow: none; }
    pre { background: #1e293b; color: #e2e8f0; padding: 20px; border-radius: 12px; font-family: 'Poppins', sans-serif; font-size: 15px; white-space: pre-wrap; line-height: 1.7; min-height: 60px; border-left: 5px solid var(--accent-color); box-shadow: inset 0 2px 10px rgba(0,0,0,0.2); }
    #infoMessage, #answerFeedback { font-size: 15px; font-weight: 500; color: var(--primary-color); margin-top: 5px; text-align: center; }
    #scoreContainer { background: #e5e7eb; border-radius: 50px; overflow: hidden; height: 28px; margin-top: 15px; box-shadow: inset 0 2px 5px rgba(0,0,0,0.05); }
    #scoreBar { background: linear-gradient(to right, #10b981, #34d399); color: white; text-align: center; height: 100%; width: 0%; line-height: 28px; font-size: 14px; font-weight: 700; transition: width 0.8s cubic-bezier(0.4, 0, 0.2, 1); box-shadow: 0 0 10px rgba(16, 185, 129, 0.5); }
    .toast { position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%); background: rgba(30, 41, 59, 0.95); backdrop-filter: blur(5px); color: white; padding: 16px 24px; border-radius: 50px; box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2); z-index: 1000; font-size: 15px; font-weight: 500; display: flex; align-items: center; gap: 10px; animation: slideUpFade 0.4s ease forwards, fadeOut 0.4s ease 2.1s forwards; }
    .toast.error { background: rgba(220, 38, 38, 0.95); }
    .toast.success { background: rgba(16, 185, 129, 0.95); }
    @keyframes slideUpFade { from { opacity: 0; transform: translate(-50%, 20px); } to { opacity: 1; transform: translate(-50%, 0); } }
    @keyframes fadeOut { from { opacity: 1; } to { opacity: 0; } }
    @media (max-width: 600px) { body { padding: 20px 15px; } h1 { font-size: 32px; } .box { padding: 24px; } }
    footer { text-align: center; margin-top: 50px; color: rgba(255, 255, 255, 0.7); font-size: 14px; }
    .loading-text { animation: pulse 1.5s infinite; opacity: 0.7; }
    @keyframes pulse { 0% { opacity: 0.6; } 50% { opacity: 1; } 100% { opacity: 0.6; } }
  </style>
</head>
<body>

<div class="container">
  <h1>üöÄ LifePath AI</h1>
  <div class="subtitle">Your intelligent companion for career growth</div>

  <div class="box">
    <h2>1Ô∏è‚É£ Profile Setup</h2>
    <input id="studyLevel" type="text" placeholder="Current Status (e.g., Class 12, B.Tech CS, MBA)" />
    <select id="stream">
      <option value="">-- Select Your Stream --</option>
      <option value="Science">Science</option>
      <option value="Commerce">Commerce</option>
      <option value="Arts">Arts</option>
      <option value="Technology">Technology</option>
      <option value="Business">Business</option>
      <option value="Creative Arts">Creative Arts</option>
      <option value="Medical">Medical</option>
      <option value="Finance">Finance</option>
      <option value="Law">Law</option>
      <option value="Media">Media</option>
      <option value="Sports">Sports</option>
    </select>
    <input id="careerIdea" type="text" placeholder="Do you have a dream career? (Optional)" />
    <button onclick="saveUserInfo()">Initialize Profile</button>
    <p id="infoMessage"></p>
  </div>

  <div class="box">
    <h2>2Ô∏è‚É£ AI Suggestions</h2>
    <button id="btnSuggestions" onclick="showCareerSuggestions()">Generate Career Paths with AI</button>
    <pre id="careerSuggestions">Waiting for input...</pre>
  </div>

  <div class="box">
    <h2>3Ô∏è‚É£ Strategic Roadmap</h2>
    <select id="careerDropdown"><option>-- Initialize Profile First --</option></select>
    <button id="btnRoadmap" onclick="selectCareer()">Generate AI Roadmap</button>
    <pre id="careerRoadmap">Select a career to view your path.</pre>
  </div>

  <div class="box">
    <h2>4Ô∏è‚É£ Daily Simulation</h2>
    <button id="btnChallenge" onclick="getDailyChallenge()">Generate AI Scenario</button>
    <pre id="dailyChallenge">Ready to test your skills?</pre>
    <textarea id="challengeAnswer" rows="4" placeholder="Type your strategic solution here..."></textarea>
    <button id="btnEvaluate" onclick="submitChallengeAnswer()">Evaluate Response with AI</button>
    <p id="answerFeedback"></p>
    <div id="scoreContainer"> <div id="scoreBar">0%</div> </div>
  </div>

  <footer>&copy; 2025 LifePath AI. Engineered for your future.</footer>
</div>

<script>
  const user = {
    studyLevel: '',
    stream: '',
    careerIdea: '',
    suggestedCareers: [],
    chosenCareer: '',
    currentChallenge: ''
  };

  function saveUserInfo() {
    const study = document.getElementById('studyLevel').value.trim();
    const stream = document.getElementById('stream').value;
    const careerIdea = document.getElementById('careerIdea').value.trim();

    if (!study || !stream) return showToast('Please fill study level and stream.', 'error');

    user.studyLevel = study;
    user.stream = stream;
    user.careerIdea = careerIdea;

    document.getElementById('infoMessage').textContent = `‚úÖ Profile Active: ${stream} | ${study}`;
    showToast('Profile initialized successfully!', 'success');
  }

  // ==========================================
  // UPDATED BACKEND CALL FUNCTION
  // ==========================================
  async function callGemini(promptText) {
    // Ensure this matches your Vercel API route
    const url = '/api/generate'; 
    const data = { prompt: promptText };

    try {
      const response = await fetch(url, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(data)
      });

      const result = await response.json();
      if (result.error) throw new Error(result.error);
      return result.output;

    } catch (error) {
      console.error("AI Error:", error);
      showToast('AI Error: ' + error.message, 'error');
      return null;
    }
  }

  // ==========================================
  // 1. GENERATE CAREER SUGGESTIONS (FIXED)
  // ==========================================
  async function showCareerSuggestions() {
    if (!user.studyLevel || !user.stream) return showToast('Initialize your profile first.', 'error');

    const output = document.getElementById('careerSuggestions');
    const btn = document.getElementById('btnSuggestions');
    
    output.textContent = "‚ú® AI is analyzing your profile...";
    output.classList.add('loading-text');
    btn.disabled = true;
    btn.textContent = "Generating...";

    // FIX: Added "Current Education Level:" to prevent age confusion
    const prompt = `
      I am a student. 
      My Current Education Level is: "${user.studyLevel}".
      My Stream is: "${user.stream}".
      ${user.careerIdea ? `I am interested in "${user.careerIdea}".` : ''}
      
      Based on this education level, suggest 5 specific, modern career paths.
      Return ONLY a JSON array of strings. Example: ["Career 1", "Career 2"]
    `;

    try {
      let rawText = await callGemini(prompt);
      if (rawText) {
        rawText = rawText.replace(/```json/g, '').replace(/```/g, '').trim();
        const careers = JSON.parse(rawText);
        user.suggestedCareers = careers;
        output.textContent = '‚ú® AI Recommendation Complete. Top Matches:\n- ' + careers.join('\n- ');
        
        let dropdownHTML = '<option value="">-- Select Target Career --</option>';
        careers.forEach(c => { dropdownHTML += `<option value="${c}">${c}</option>`; });
        document.getElementById('careerDropdown').innerHTML = dropdownHTML;
        showToast('Career paths generated!', 'success');
      }
    } catch (e) {
      output.textContent = "Failed to parse AI response. Try again.";
    } finally {
      output.classList.remove('loading-text');
      btn.disabled = false;
      btn.textContent = "Generate Career Paths";
    }
  }

  // ==========================================
  // 2. GENERATE ROADMAP (FIXED)
  // ==========================================
  async function selectCareer() {
    const choice = document.getElementById('careerDropdown').value;
    if (!choice) return showToast('Select a career first.', 'error');
    user.chosenCareer = choice;

    const output = document.getElementById('careerRoadmap');
    const btn = document.getElementById('btnRoadmap');

    output.textContent = `üöÄ Designing custom roadmap for ${choice}...`;
    output.classList.add('loading-text');
    btn.disabled = true;

    // FIX: Explicitly stated "Education Level"
    const prompt = `
      Create a 5-step detailed career roadmap for becoming a "${choice}" in India/Global context.
      The user's Current Education Level is: "${user.studyLevel}".
      The user's Stream is: "${user.stream}".
      
      Important: Treat "${user.studyLevel}" as an educational grade/qualification, NOT an age.
      Format the output as a clean numbered list with emojis. Keep it concise.
    `;

    const result = await callGemini(prompt);
    
    if (result) {
      output.textContent = result;
      showToast(`Target set: ${choice}`, 'success');
      
      document.getElementById('dailyChallenge').textContent = 'Ready for simulation?';
      document.getElementById('challengeAnswer').value = '';
      document.getElementById('answerFeedback').textContent = '';
      document.getElementById('scoreBar').style.width = '0%';
      document.getElementById('scoreBar').textContent = '0%';
    }
    
    output.classList.remove('loading-text');
    btn.disabled = false;
  }

  // ==========================================
  // 3. GENERATE CHALLENGE (SAME AS BEFORE)
  // ==========================================
  async function getDailyChallenge() {
    if (!user.chosenCareer) return showToast('Select a career first.', 'error');

    const output = document.getElementById('dailyChallenge');
    const btn = document.getElementById('btnChallenge');

    output.textContent = "üé≤ Generating a realistic scenario...";
    output.classList.add('loading-text');
    btn.disabled = true;

    const prompt = `
      Give me a specific, difficult, one-sentence day-to-day professional scenario/problem 
      faced by a "${user.chosenCareer}". 
      Do not give the solution. Just the scenario.
    `;

    const result = await callGemini(prompt);
    
    if (result) {
      user.currentChallenge = result;
      output.textContent = "üî• SCENARIO: " + result;
      document.getElementById('challengeAnswer').value = '';
      document.getElementById('answerFeedback').textContent = '';
      document.getElementById('scoreBar').style.width = '0%';
      document.getElementById('scoreBar').textContent = '0%';
    }

    output.classList.remove('loading-text');
    btn.disabled = false;
  }

  // ==========================================
  // 4. EVALUATE ANSWER (SAME AS BEFORE)
  // ==========================================
  async function submitChallengeAnswer() {
    const answer = document.getElementById('challengeAnswer').value.trim();
    if (!answer) return showToast('Input your strategy first.', 'error');
    if (!user.currentChallenge) return showToast('Generate a challenge first.', 'error');

    const feedbackElem = document.getElementById('answerFeedback');
    const btn = document.getElementById('btnEvaluate');

    feedbackElem.textContent = "üß† AI is grading your response...";
    feedbackElem.classList.add('loading-text');
    btn.disabled = true;

    const prompt = `
      Roleplay: You are a senior mentor in the field of "${user.chosenCareer}".
      Scenario: "${user.currentChallenge}"
      Student's Answer: "${answer}"
      
      Task:
      1. Rate the answer from 0 to 100 based on professionalism, logic, and feasibility.
      2. Provide a 1-sentence feedback.
      
      Return ONLY JSON format: {"score": number, "feedback": "string"}
    `;

    try {
      let rawText = await callGemini(prompt);
      if (rawText) {
        rawText = rawText.replace(/```json/g, '').replace(/```/g, '').trim();
        const result = JSON.parse(rawText);
        const score = result.score;
        const feedback = result.feedback;

        feedbackElem.textContent = feedback;
        document.getElementById('scoreBar').style.width = score + '%';
        document.getElementById('scoreBar').textContent = score + '%';
        
        const bar = document.getElementById('scoreBar');
        if(score < 50) bar.style.background = '#ef4444'; 
        else if(score < 80) bar.style.background = '#f59e0b'; 
        else bar.style.background = 'linear-gradient(to right, #10b981, #34d399)';
      }
    } catch (e) {
      feedbackElem.textContent = "Evaluation failed. Please try again.";
    } finally {
      feedbackElem.classList.remove('loading-text');
      btn.disabled = false;
    }
  }

  function showToast(message, type = 'info') {
    const toast = document.createElement('div');
    toast.className = 'toast ' + type;
    toast.innerHTML = type === 'success' ? '‚úÖ ' + message : '‚ö†Ô∏è ' + message;
    document.body.appendChild(toast);
    setTimeout(() => toast.remove(), 2500);
  }
</script>

</body>
</html>
